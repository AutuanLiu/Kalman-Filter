# 估计器测试结果-预览版

```python
Email: autuanliu@163.com
Date: 2018/12/14
```

## 测试仿真模型

- ARX 模型

```python
x1(t) = 0.92*sqrt(2) * x1(t-1) - 0.9025 * x1(t-2) + e1(t)
x2(t) = 0.5 * x1(t-2) + e2(t)
x3(t) = -0.4 * x1(t-3) + e3(t)
x4(t) = -0.5 * x1(t-2) + 0.25*sqrt(2) * x4(t-1) + 0.25*sqrt(2) * x5(t-1) + e4(t)
x5(t) = -0.25*sqrt(2) * x4(t-1) + 0.25*sqrt(2) * x5(t-1) + e5(t)
```

- NARX 模型

```python
x1(t) = 0.92*sqrt(2) * x1(t-1) - 0.9025 * x1(t-2) + e1(t)
x2(t) = 0.5 * x1^2(t-2) + e2(t)
x3(t) = -0.4 * x1(t-3) + e3(t)
x4(t) = -0.5 * x1^2(t-2) + 0.25*sqrt(2) * x4(t-1) + 0.25*sqrt(2) * x5(t-1) + e4(t)
x5(t) = -0.25*sqrt(2) * x4(t-1) + 0.25*sqrt(2) * x5(t-1) + e5(t)
```

- Global Setting
  - max_lag = 5
  - norder = 2(NARX)
  - norder = 1(ARX)
  - threshold = 5(候选项个数)

## [Kalman4ARX 估计器](./kalman_ARX.py)

**思路**：使用 Linear Kalman Filter 对 ARX 模型进行系数估计

```python
x1(t) = 1.3718 * x1(t-1) + -0.8797 * x1(t-2) + 0.1964 * x1(t-4) + e1(t)
x2(t) = 0.8318 * x1(t-2) + e2(t)
x3(t) = 0.1501 * x1(t-1) + -0.7156 * x1(t-3) + 0.4319 * x1(t-4) + 0.1395 * x2(t-4) + 0.1241 * x3(t-1) + 0.1940 * x4(t-1) + 0.1892 * x4(t-2) + e3(t)
x4(t) = 0.1042 * x1(t-1) + -0.6328 * x1(t-2) + 0.3441 * x1(t-4) + 0.4616 * x4(t-1) + 0.2421 * x5(t-1) + e4(t)
x5(t) = 0.1235 * x1(t-1) + 0.3161 * x1(t-4) + 0.1034 * x3(t-1) + -0.4531 * x4(t-1) + 0.1389 * x4(t-2) + 0.3927 * x5(t-1) + e5(t)
```

## [Kalman4FROLS 估计器](./kalman_NARX.py)

**思路**：使用 Linear Kalman Filter 和基于 FROLS 的模型候选项选择器 对 ARX or NARX 模型进行系数估计

- 可以设置训练次数和学习率

### ARX

```python
x1(t) = 1.3964 * x1(t-1) + -0.7985 * x1(t-2) + 0.1934 * x1(t-4) + 0.2218 * x4(t-1) + -0.0061 * x4(t-2) + e1(t)
x2(t) = 0.8987 * x1(t-2) + -0.0234 * x2(t-5) + 0.0431 * x3(t-1) + 0.0257 * x3(t-2) + -0.0126 * x4(t-3) + e2(t)
x3(t) = -0.0054 * x1(t-2) + 0.1569 * x2(t-4) + 0.0949 * x2(t-5) + 0.1376 * x3(t-1) + 0.5317 * x4(t-1) + e3(t)
x4(t) = -0.3851 * x1(t-2) + 0.3676 * x1(t-5) + 0.5543 * x4(t-1) + 0.2197 * x4(t-3) + 0.2447 * x5(t-1) + e4(t)
x5(t) = 0.0886 * x1(t-2) + 0.4337 * x1(t-4) + -0.4315 * x4(t-1) + 0.4117 * x4(t-2) + 0.4667 * x5(t-1) + e5(t)
```

### NARX

```python
x1(t) = 1.2981 * x1(t-1) + 0.1726 * x4(t-2) + -0.4987 * x1(t-2)*x1(t-2) + -0.3605 * x1(t-2)*x4(t-2) + 0.1129 * x1(t-5)*x2(t-4) + e1(t)
x2(t) = -0.0317 * x2(t-2) + 0.5266 * x2(t-1)*x4(t-2) + 0.9019 * x2(t-3)*x5(t-3) + 0.4008 * x2(t-4)*x4(t-4) + -0.0630 * x2(t-5)*x4(t-4) + e2(t)
x3(t) = 0.8342 * x3(t-2) + 0.4146 * x4(t-2) + 0.3358 * x5(t-1) + -1.5313 * x1(t-3)*x3(t-2) + 0.0857 * x1(t-5)*x3(t-1) + e3(t)
x4(t) = 0.7393 * x4(t-1) + 0.3526 * x4(t-4) + 0.3864 * x2(t-1)*x2(t-2) + -0.2262 * x4(t-2)*x4(t-5) + 0.1311 * x4(t-3)*x4(t-5) + e4(t)
x5(t) = 0.5467 * x2(t-1) + 0.0516 * x2(t-2) + 0.0197 * x4(t-5) + 0.2492 * x4(t-3)*x5(t-1) + 0.3152 * x4(t-4)*x5(t-1) + e5(t)
```

## [torch4FROLS 估计器](./kalman_NARX.py)

**思路**：使用 Linear Regression 和基于 FROLS 的模型候选项选择器 对 ARX or NARX 模型进行系数估计，可以看做是 FROLS 的拆分版

### ARX

```python
x1(t) = 1.3557 * x1(t-1) + -0.8022 * x1(t-2) + 0.2062 * x1(t-4) + 0.1881 * x4(t-1) + 0.0629 * x4(t-2) + e1(t)
x2(t) = 0.9309 * x1(t-2) + -0.0196 * x2(t-5) + 0.0258 * x3(t-1) + -0.0367 * x3(t-2) + 0.0186 * x4(t-3) + e2(t)
x3(t) = -0.0281 * x1(t-2) + 0.1644 * x2(t-4) + 0.1028 * x2(t-5) + 0.1761 * x3(t-1) + 0.5004 * x4(t-1) + e3(t)
x4(t) = -0.4204 * x1(t-2) + 0.3640 * x1(t-5) + 0.5527 * x4(t-1) + 0.2481 * x4(t-3) + 0.2534 * x5(t-1) + e4(t)
x5(t) = 0.1725 * x1(t-2) + 0.4034 * x1(t-4) + -0.3244 * x4(t-1) + 0.2729 * x4(t-2) + 0.4316 * x5(t-1) + e5(t)
```

### NARX

```python
x1(t) = 1.3664 * x1(t-1) + -0.9156 * x1(t-2) + 0.0019 * x1(t-4) + -0.0005 * x2(t-1)*x3(t-5) + -0.0021 * x2(t-4)*x3(t-2) + e1(t)
x2(t) = 0.5024 * x1(t-2)*x1(t-2) + -0.0001 * x2(t-1)*x4(t-3) + 0.0016 * x3(t-1)*x5(t-4) + -0.0109 * x3(t-3)*x3(t-3) + 0.0054 * x3(t-5)*x5(t-3) + e2(t)
x3(t) = -0.3795 * x1(t-3) + -0.0291 * x3(t-3) + 0.0001 * x2(t-2)*x2(t-2) + 0.0053 * x3(t-4)*x5(t-5) + -0.0028 * x3(t-5)*x5(t-5) + e3(t)
x4(t) = 0.2722 * x4(t-1) + 0.2689 * x5(t-1) + 0.0593 * x5(t-2) + -0.4993 * x1(t-2)*x1(t-2) + -0.0448 * x1(t-3)*x1(t-3) + e4(t)
x5(t) = -0.3525 * x4(t-1) + 0.3556 * x5(t-1) + 0.0019 * x2(t-1)*x5(t-5) + 0.0000 * x2(t-3)*x4(t-5) + 0.0008 * x4(t-1)*x5(t-4) + e5(t)
```

- 以上结果均非最优结果
- 参数未做调优

Notes: 示例代码 [example code](./test.py)
